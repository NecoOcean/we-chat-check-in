# 核心模块测试用例

**文档版本：** v1.1.0  
**创建日期：** 2024-11-01  
**更新日期：** 2024-11-01  
**功能覆盖：** 活动管理、二维码管理、打卡参与、活动评价  
**测试数据脚本：** `sql/test_county_statistics_data.sql`  

---

## 📋 文档概述

本文档提供微信打卡小程序系统四个核心模块的完整测试用例，包括：

1. **活动管理模块** - 创建活动、查询活动、结束活动、县域统计
2. **二维码管理模块** - 生成二维码、查询二维码、禁用二维码、验证二维码
3. **打卡参与模块** - 提交打卡、查询打卡、打卡统计、幂等性验证
4. **活动评价模块** - 提交评价、查询评价、评价统计、权限隔离

---

## 🎯 测试环境准备

### 前置条件

1. **应用启动**
   ```bash
   cd backend
   mvn spring-boot:run
   ```

2. **测试数据导入**
   ```bash
   mysql -u root -p wechat_checkin < sql/test_county_statistics_data.sql
   ```

3. **获取管理员token**
   ```bash
   # 市级管理员登录
   curl -X POST "http://localhost:8080/api/auth/login" \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   
   # 记录返回的token
   ```

### 测试账号

| 账号 | 密码 | 角色 | 县域 | 用途 |
|------|------|------|------|------|
| admin | admin123 | 市级管理员 | 无 | 全系统测试 |
| chaoyang_admin | admin123 | 县级管理员 | 朝阳区(001) | 权限隔离测试 |
| fengtai_admin | admin123 | 县级管理员 | 丰台区(002) | 权限隔离测试 |
| dongcheng_admin | admin123 | 县级管理员 | 东城区(003) | 权限隔离测试 |

---

# 第一部分：活动管理模块测试用例

## 模块概述

活动管理模块负责活动的创建、查询、结束和统计功能。

### 核心API

| 方法 | 路径 | 权限 | 功能 |
|------|------|------|------|
| POST | `/api/activities` | 市/县级 | 创建活动 |
| GET | `/api/activities` | 市/县级 | 查询活动列表 |
| GET | `/api/activities/{id}` | 市/县级 | 查询活动详情 |
| POST | `/api/activities/{id}/finish` | 市/县级 | 结束活动 |
| GET | `/api/activities/{id}/county-statistics` | 市/县级 | 县域打卡统计(新增) |

---

## 测试用例 1.1：市级管理员创建活动

**用例ID：** ACTIVITY-001  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 创建活动、打卡二维码自动生成

**前置条件：**
- 应用已启动
- 市级管理员已登录，获得有效token
- 数据库中存在活动所需的基础数据

**测试步骤：**

1. 登录获取token
```bash
curl -X POST "http://localhost:8080/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'

# 记录返回的 token
CITY_ADMIN_TOKEN="<返回的token>"
```

2. 创建活动
```bash
curl -X POST "http://localhost:8080/api/activities" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "2024年冬季教学活动",
    "description": "全市冬季教学总结和评估",
    "startTime": "2024-12-01T08:00:00",
    "endTime": "2024-12-31T17:00:00"
  }'
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回新创建的活动ID
- ✅ 活动状态为 `ONGOING`
- ✅ 自动生成了打卡二维码
- ✅ 二维码数量为2（打卡+评价）

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": 3,
  "timestamp": 1698765432000
}
```

**验证步骤：**
```sql
-- 验证活动创建
SELECT id, name, status, scope_county_code FROM activities WHERE name = '2024年冬季教学活动';

-- 验证二维码生成
SELECT id, activity_id, type, status FROM qrcodes WHERE activity_id = 3 ORDER BY type;
```

---

## 测试用例 1.2：县级管理员创建活动（权限范围）

**用例ID：** ACTIVITY-002  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 权限隔离、县级活动

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

1. 县级管理员登录
```bash
curl -X POST "http://localhost:8080/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "chaoyang_admin",
    "password": "admin123"
  }'

COUNTY_ADMIN_TOKEN="<返回的token>"
```

2. 创建县级活动
```bash
curl -X POST "http://localhost:8080/api/activities" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "朝阳区2024年秋季教学活动",
    "description": "朝阳区的专属活动",
    "startTime": "2024-11-15T08:00:00",
    "endTime": "2024-11-30T17:00:00"
  }'
```

**预期结果：**

- ✅ HTTP 200，活动创建成功
- ✅ 活动的 `scope_county_code` 为 `001`（朝阳区）
- ✅ 打卡二维码自动生成

**验证步骤：**
```sql
-- 验证县级活动的县域范围
SELECT id, name, scope_county_code, status FROM activities 
WHERE name = '朝阳区2024年秋季教学活动';
```

---

## 测试用例 1.3：查询活动列表（市级管理员）

**用例ID：** ACTIVITY-003  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 分页查询、权限隔离

**前置条件：**
- 市级管理员已登录
- 数据库中至少有3个活动

**测试步骤：**

```bash
# 查询所有活动
curl -X GET "http://localhost:8080/api/activities?current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 查询进行中的活动
curl -X GET "http://localhost:8080/api/activities?current=1&size=10&status=ONGOING" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按县域过滤
curl -X GET "http://localhost:8080/api/activities?current=1&size=10&scopeCountyCode=001" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回分页数据
- ✅ 每条活动包含基本信息（ID、名称、状态、创建时间等）
- ✅ 市级管理员能看到所有活动

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "name": "2024年秋季教学活动",
        "status": "ONGOING",
        "startTime": "2024-10-30T08:00:00",
        "endTime": "2024-12-31T17:00:00",
        "scopeCountyCode": "001"
      }
    ],
    "total": 3,
    "current": 1,
    "size": 10
  }
}
```

---

## 测试用例 1.4：查询活动列表（县级管理员权限）

**用例ID：** ACTIVITY-004  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 数据权限隔离

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
# 县级管理员查询活动列表
curl -X GET "http://localhost:8080/api/activities?current=1&size=10" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 仅返回朝阳区的活动或全市活动
- ✅ 不返回其他县区的专属活动

**验证要点：**
- ✅ 返回的所有活动的 `scopeCountyCode` 为 null（全市）或 `001`（朝阳区）
- ✅ 不包含丰台区(002)、东城区(003)的专属活动

---

## 测试用例 1.5：查询活动详情（包含打卡统计）

**用例ID：** ACTIVITY-005  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 活动详情、打卡统计、二维码信息

**前置条件：**
- 市级管理员已登录
- 活动ID为1（从测试数据）
- 活动已有打卡记录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/activities/1" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回活动基本信息
- ✅ 返回参与教学点数（participatedCount）
- ✅ 返回总参与人数（totalAttendees）
- ✅ 返回评价数量（evaluationCount）
- ✅ 返回二维码列表（打卡+评价）

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "activity": {
      "id": 1,
      "name": "2024年秋季教学活动",
      "status": "ONGOING",
      "startTime": "2024-10-30T08:00:00",
      "endTime": "2024-12-31T17:00:00"
    },
    "participatedCount": 15,
    "totalAttendees": 420,
    "evaluationCount": 15,
    "qrCodes": [
      {
        "id": 1,
        "type": "checkin",
        "status": "enabled",
        "expireTime": "2024-12-06T23:59:59"
      },
      {
        "id": 2,
        "type": "evaluation",
        "status": "enabled",
        "expireTime": "2024-12-06T23:59:59"
      }
    ]
  }
}
```

---

## 测试用例 1.6：结束活动（自动结束）

**用例ID：** ACTIVITY-006  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 活动结束、打卡二维码禁用、评价二维码保留

**前置条件：**
- 市级管理员已登录
- 活动ID为1，状态为 ONGOING

**测试步骤：**

```bash
# 结束活动
curl -X POST "http://localhost:8080/api/activities/1/finish" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 活动状态变为 FINISHED
- ✅ 打卡二维码被禁用
- ✅ 评价二维码保持可用

**验证步骤：**
```sql
-- 验证活动状态
SELECT id, status, ended_time FROM activities WHERE id = 1;

-- 验证二维码状态
SELECT id, type, status, disabled_time FROM qrcodes WHERE activity_id = 1;
```

**验证要点：**
- ✅ 打卡二维码(checkin) 状态为 disabled
- ✅ 评价二维码(evaluation) 状态保持 enabled

---

## 测试用例 1.7：县域打卡统计（市级管理员专用）

**用例ID：** ACTIVITY-007  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 县域统计、打卡详情、权限隔离

**前置条件：**
- 市级管理员已登录
- 活动ID为1，有跨县域的打卡记录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/activities/1/county-statistics" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ countyStatistics 包含3个县域的统计
- ✅ 每个县域包含：
  - countyCode / countyName
  - participatingPoints（教学点数）
  - totalAttendees（累计人数）
  - totalCheckins（打卡次数）
- ✅ checkinDetails 包含全部15条打卡记录
- ✅ 按县域和时间排序

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "activity": { ... },
    "participatedCount": 15,
    "totalAttendees": 420,
    "evaluationCount": 15,
    "countyStatistics": [
      {
        "countyCode": "001",
        "countyName": "朝阳区",
        "participatingPoints": 5,
        "totalAttendees": 150,
        "totalCheckins": 5
      },
      {
        "countyCode": "002",
        "countyName": "丰台区",
        "participatingPoints": 5,
        "totalAttendees": 145,
        "totalCheckins": 5
      },
      {
        "countyCode": "003",
        "countyName": "东城区",
        "participatingPoints": 5,
        "totalAttendees": 125,
        "totalCheckins": 5
      }
    ],
    "checkinDetails": [
      {
        "id": 1,
        "teachingPointId": 1,
        "teachingPointName": "朝阳区第一小学",
        "countyCode": "001",
        "countyName": "朝阳区",
        "attendeeCount": 30,
        "submittedTime": "2024-10-30T14:30:00"
      }
    ]
  }
}
```

---

## 测试用例 1.8：县级管理员查看县域统计（权限隔离）

**用例ID：** ACTIVITY-008  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 权限隔离、只能查看本县打卡详情

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/activities/1/county-statistics" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ countyStatistics 为 null（权限隔离）
- ✅ checkinDetails 仅包含朝阳区的5条记录
- ✅ 不包含其他县区的数据

**验证要点：**
- ✅ countyStatistics === null
- ✅ checkinDetails.length === 5
- ✅ 所有checkinDetails的countyCode === "001"

---

## 测试用例 1.9：创建活动参数验证

**用例ID：** ACTIVITY-009  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 参数校验、错误处理

**测试场景：**

### 场景1：缺少必填字段（活动名称）
```bash
curl -X POST "http://localhost:8080/api/activities" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "缺少名称的活动",
    "startTime": "2024-12-01T08:00:00",
    "endTime": "2024-12-31T17:00:00"
  }'
```

**预期结果：**
- ✅ HTTP 400 或 422（参数校验失败）
- ✅ 返回错误消息指示缺少活动名称

### 场景2：结束时间早于开始时间
```bash
curl -X POST "http://localhost:8080/api/activities" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "时间错误的活动",
    "description": "结束时间早于开始时间",
    "startTime": "2024-12-31T17:00:00",
    "endTime": "2024-12-01T08:00:00"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 返回错误消息指示时间配置不合法

### 场景3：过去的时间
```bash
curl -X POST "http://localhost:8080/api/activities" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "过期的活动",
    "description": "开始时间在过去",
    "startTime": "2024-01-01T08:00:00",
    "endTime": "2024-01-31T17:00:00"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 返回错误消息指示活动时间不合法

---

## 测试用例 1.10：活动不存在错误处理

**用例ID：** ACTIVITY-010  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 错误处理、404

**测试步骤：**

```bash
# 查询不存在的活动
curl -X GET "http://localhost:8080/api/activities/99999" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 404 或返回错误码
- ✅ 返回错误消息："活动不存在"

---

---

# 第二部分：二维码管理模块测试用例

## 模块概述

二维码管理模块负责生成、查询、禁用和验证二维码。

### 核心API

| 方法 | 路径 | 权限 | 功能 |
|------|------|------|------|
| POST | `/api/activities/{id}/qrcodes` | 市/县级 | 生成二维码 |
| GET | `/api/qrcodes` | 市/县级 | 查询二维码列表 |
| GET | `/api/qrcodes/{id}` | 市/县级 | 查询二维码详情 |
| PATCH | `/api/qrcodes/{id}/disable` | 市/县级 | 禁用二维码 |
| GET | `/api/qrcodes/verify?token=...` | 无需认证 | 验证二维码 |

---

## 测试用例 2.1：生成打卡二维码

**用例ID：** QRCODE-001  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 生成二维码、打卡类型

**前置条件：**
- 市级管理员已登录
- 活动ID为1存在

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/activities/1/qrcodes" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "checkin",
    "expireTime": "2024-12-10T23:59:59"
  }'
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回二维码信息，包括：
  - id：二维码ID
  - type：checkin
  - token：JWT令牌
  - expireTime：过期时间
  - status：enabled
  - qrCodeImage：Base64编码的二维码图片
  - url：二维码链接

**响应示例：**
```json
{
  "code": 200,
  "message": "二维码生成成功",
  "data": {
    "id": 3,
    "activityId": 1,
    "type": "checkin",
    "token": "eyJhbGciOiJIUzUxMiJ9...",
    "expireTime": "2024-12-10T23:59:59",
    "status": "enabled",
    "createdTime": "2024-11-01T10:00:00",
    "qrCodeImage": "data:image/png;base64,iVBORw0KG...",
    "url": "http://localhost:8080/api/qrcodes/verify?token=eyJhbGciOiJIUzUxMiJ9..."
  }
}
```

---

## 测试用例 2.2：生成评价二维码

**用例ID：** QRCODE-002  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 生成二维码、评价类型

**前置条件：**
- 市级管理员已登录
- 活动ID为1存在

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/activities/1/qrcodes" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "evaluation",
    "expireTime": "2024-12-10T23:59:59"
  }'
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回二维码信息
- ✅ type 为 evaluation
- ✅ 二维码图片正确生成

---

## 测试用例 2.3：查询二维码列表

**用例ID：** QRCODE-003  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 分页查询、按类型过滤

**测试步骤：**

```bash
# 查询所有二维码
curl -X GET "http://localhost:8080/api/qrcodes?current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按活动过滤
curl -X GET "http://localhost:8080/api/qrcodes?activityId=1&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按类型过滤
curl -X GET "http://localhost:8080/api/qrcodes?type=checkin&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按状态过滤
curl -X GET "http://localhost:8080/api/qrcodes?status=enabled&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回分页数据
- ✅ 每条记录包含二维码的完整信息

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [
      {
        "id": 1,
        "activityId": 1,
        "type": "checkin",
        "status": "enabled",
        "expireTime": "2024-12-06T23:59:59",
        "createdTime": "2024-10-30T00:00:00"
      },
      {
        "id": 2,
        "activityId": 1,
        "type": "evaluation",
        "status": "enabled",
        "expireTime": "2024-12-06T23:59:59",
        "createdTime": "2024-10-30T00:00:00"
      }
    ],
    "total": 2,
    "current": 1,
    "size": 10
  }
}
```

---

## 测试用例 2.4：查询二维码详情

**用例ID：** QRCODE-004  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 查询详情

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/qrcodes/1" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回二维码详细信息
- ✅ 包含Base64编码的二维码图片

---

## 测试用例 2.5：禁用单个二维码

**用例ID：** QRCODE-005  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 禁用二维码

**前置条件：**
- 市级管理员已登录
- 二维码ID为1存在，状态为 enabled

**测试步骤：**

```bash
curl -X PATCH "http://localhost:8080/api/qrcodes/1/disable" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回成功消息："二维码已禁用"

**验证步骤：**
```sql
-- 验证二维码状态
SELECT id, status, disabled_time FROM qrcodes WHERE id = 1;
```

**验证要点：**
- ✅ 二维码状态变为 disabled
- ✅ disabled_time 被设置

---

## 测试用例 2.6：验证有效的二维码

**用例ID：** QRCODE-006  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 验证二维码、无需认证

**前置条件：**
- 活动ID为1存在
- 打卡二维码ID为1，状态为 enabled，未过期

**测试步骤：**

1. 获取二维码token
```sql
SELECT token FROM qrcodes WHERE id = 1 AND type = 'checkin';
```

2. 验证二维码
```bash
curl -X GET "http://localhost:8080/api/qrcodes/verify?token=<token>" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ valid = true
- ✅ 返回二维码详情：
  - qrcodeId
  - activityId
  - type
  - expireTime

**响应示例：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "valid": true,
    "qrcodeId": 1,
    "activityId": 1,
    "type": "checkin",
    "expireTime": "2024-12-06T23:59:59",
    "reason": null
  }
}
```

---

## 测试用例 2.7：验证已禁用的二维码

**用例ID：** QRCODE-007  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 错误处理、二维码已禁用

**前置条件：**
- 二维码已被禁用

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/qrcodes/verify?token=<禁用二维码的token>" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ valid = false
- ✅ reason = "二维码已被禁用"

---

## 测试用例 2.8：验证过期的二维码

**用例ID：** QRCODE-008  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 过期验证

**前置条件：**
- 已生成一个过期的二维码

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/qrcodes/verify?token=<过期二维码的token>" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ valid = false
- ✅ reason = "二维码已过期"

---

## 测试用例 2.9：验证无效的token

**用例ID：** QRCODE-009  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 错误处理、无效token

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/qrcodes/verify?token=invalid_token_12345" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ valid = false
- ✅ reason = "二维码令牌无效"

---

## 测试用例 2.10：生成二维码参数校验

**用例ID：** QRCODE-010  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 参数验证

### 场景1：缺少类型
```bash
curl -X POST "http://localhost:8080/api/activities/1/qrcodes" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "expireTime": "2024-12-10T23:59:59"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 返回参数校验错误

### 场景2：无效的类型
```bash
curl -X POST "http://localhost:8080/api/activities/1/qrcodes" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "invalid_type",
    "expireTime": "2024-12-10T23:59:59"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 返回错误信息："无效的二维码类型"

---

---

# 第三部分：打卡参与模块测试用例

## 模块概述

打卡参与模块负责处理教学点的打卡提交、数据查询和统计功能。

### 核心API

| 方法 | 路径 | 权限 | 功能 |
|------|------|------|------|
| POST | `/api/checkins/checkin` | 无需认证 | 提交打卡 |
| GET | `/api/checkins` | 市/县级 | 查询打卡记录 |
| GET | `/api/checkins/statistics/{activityId}` | 市/县级 | 查询打卡统计 |

---

## 测试用例 3.1：提交有效打卡

**用例ID：** CHECKIN-001  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 提交打卡、有效二维码

**前置条件：**
- 活动ID为1，状态为 ONGOING
- 打卡二维码ID为1，状态为 enabled，未过期
- 教学点ID为1存在

**测试步骤：**

1. 获取打卡二维码token
```sql
SELECT token FROM qrcodes WHERE id = 1 AND type = 'checkin';
```

2. 提交打卡
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<二维码token>",
    "teachingPointId": 1,
    "attendeeCount": 30
  }'
```

**预期结果：**

- ✅ HTTP 200
- ✅ success = true
- ✅ 返回打卡信息：
  - checkinId：打卡ID
  - submittedTime：提交时间
  - message：成功消息

**响应示例：**
```json
{
  "code": 200,
  "message": "打卡成功",
  "data": {
    "success": true,
    "checkinId": 1,
    "submittedTime": "2024-11-01T10:30:00",
    "message": "打卡提交成功"
  }
}
```

**验证步骤：**
```sql
-- 验证打卡记录
SELECT id, activity_id, teaching_point_id, attendee_count, submitted_time 
FROM checkins 
WHERE activity_id = 1 AND teaching_point_id = 1;
```

---

## 测试用例 3.2：防重复打卡（幂等性）

**用例ID：** CHECKIN-002  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 幂等性、防重复

**前置条件：**
- 活动1、教学点1已经打过卡
- 同一个打卡二维码

**测试步骤：**

```bash
# 第一次打卡（已在上一个测试中完成）
# 现在尝试第二次打卡

curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<二维码token>",
    "teachingPointId": 1,
    "attendeeCount": 35
  }'
```

**预期结果：**

- ✅ HTTP 400 或 409（冲突/重复）
- ✅ 返回错误消息："该活动的教学点已打过卡，不可重复打卡"
- ✅ 数据库中仍只有一条打卡记录

**验证步骤：**
```sql
-- 验证仍只有一条记录
SELECT COUNT(*) FROM checkins WHERE activity_id = 1 AND teaching_point_id = 1;
```

---

## 测试用例 3.3：提交打卡参数校验

**用例ID：** CHECKIN-003  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 参数验证

### 场景1：缺少token
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingPointId": 1,
    "attendeeCount": 30
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："token不能为空"

### 场景2：参与人数为0
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<token>",
    "teachingPointId": 1,
    "attendeeCount": 0
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："参与人数必须大于0"

### 场景3：教学点ID无效
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<token>",
    "teachingPointId": 0,
    "attendeeCount": 30
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："教学点ID必须大于0"

---

## 测试用例 3.4：无效的二维码提交打卡

**用例ID：** CHECKIN-004  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 错误处理、无效二维码

### 场景1：已禁用的二维码
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<已禁用二维码的token>",
    "teachingPointId": 1,
    "attendeeCount": 30
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："二维码已被禁用"

### 场景2：过期的二维码
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<已过期二维码的token>",
    "teachingPointId": 1,
    "attendeeCount": 30
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："二维码已过期"

### 场景3：评价二维码（错误的类型）
```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<评价二维码的token>",
    "teachingPointId": 1,
    "attendeeCount": 30
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："二维码类型不是打卡类型"

---

## 测试用例 3.5：活动已结束打卡失败

**用例ID：** CHECKIN-005  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 活动状态校验

**前置条件：**
- 活动已被标记为 FINISHED
- 打卡二维码已禁用

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/checkins/checkin" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<已结束活动的打卡二维码token>",
    "teachingPointId": 10,
    "attendeeCount": 25
  }'
```

**预期结果：**

- ✅ HTTP 400
- ✅ 错误消息："二维码已被禁用" 或 "活动未进行中"

---

## 测试用例 3.6：查询打卡记录（市级管理员）

**用例ID：** CHECKIN-006  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 查询打卡、权限隔离

**前置条件：**
- 市级管理员已登录
- 数据库中有多条打卡记录

**测试步骤：**

```bash
# 查询所有打卡
curl -X GET "http://localhost:8080/api/checkins?current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按活动过滤
curl -X GET "http://localhost:8080/api/checkins?activityId=1&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按教学点过滤
curl -X GET "http://localhost:8080/api/checkins?teachingPointId=1&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回分页数据
- ✅ 市级管理员可见全部打卡记录（所有县）

**响应示例：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "records": [
      {
        "id": 1,
        "activityId": 1,
        "activityName": "2024年秋季教学活动",
        "teachingPointId": 1,
        "teachingPointName": "朝阳区第一小学",
        "attendeeCount": 30,
        "submittedTime": "2024-10-30T14:30:00",
        "county": "朝阳区"
      }
    ],
    "total": 15,
    "current": 1,
    "size": 10
  }
}
```

---

## 测试用例 3.7：查询打卡记录（县级管理员权限隔离）

**用例ID：** CHECKIN-007  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 权限隔离、数据隔离

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/checkins?current=1&size=10" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 仅返回朝阳区的打卡记录
- ✅ 不返回其他县区的数据

**验证要点：**
- ✅ 所有记录的 county 都是 "朝阳区"
- ✅ total <= 5（朝阳区的教学点数）

---

## 测试用例 3.8：查询打卡统计（市级管理员）

**用例ID：** CHECKIN-008  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 打卡统计、参与人数、教学点数

**前置条件：**
- 市级管理员已登录
- 活动ID为1有打卡记录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/checkins/statistics/1" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回统计信息：
  - activityId：1
  - participatingTeachingPoints：15
  - totalAttendees：420

**响应示例：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "activityId": 1,
    "participatingTeachingPoints": 15,
    "totalAttendees": 420
  }
}
```

---

## 测试用例 3.9：查询打卡统计（县级管理员）

**用例ID：** CHECKIN-009  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 权限隔离、统计

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/checkins/statistics/1" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 仅统计朝阳区的打卡数据
- ✅ participatingTeachingPoints = 5
- ✅ totalAttendees = 150（朝阳区的总人数）

---

## 测试用例 3.10：未登录访问管理员接口

**用例ID：** CHECKIN-010  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 权限验证、未认证

**测试步骤：**

```bash
# 不提供Authorization header
curl -X GET "http://localhost:8080/api/checkins?current=1&size=10" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 401
- ✅ 返回错误消息："未授权" 或 "请登录"

---

---

# 第四部分：活动评价模块测试用例

## 模块概述

活动评价模块负责处理教学点的评价提交、数据查询和统计功能。

### 核心API

| 方法 | 路径 | 权限 | 功能 |
|------|------|------|------|
| POST | `/api/evaluations/evaluation` | 无需认证 | 提交评价 |
| GET | `/api/evaluations` | 市/县级 | 查询评价记录 |
| GET | `/api/evaluations/statistics` | 市/县级 | 查询评价统计 |

---

## 测试用例 4.1：提交有效评价

**用例ID：** EVALUATION-001  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 提交评价、有效二维码、活动已结束

**前置条件：**
- 活动ID为1，状态为 FINISHED
- 评价二维码ID为2，状态为 enabled，未过期
- 教学点ID为1已有打卡记录

**测试步骤：**

1. 获取评价二维码token
```sql
SELECT token FROM qrcodes WHERE id = 2 AND type = 'evaluation';
```

2. 提交评价
```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<评价二维码token>",
    "teachingPointId": 1,
    "q1Satisfaction": 3,
    "q2Practicality": 2,
    "q3Quality": 3,
    "suggestionText": "希望能增加更多互动环节"
  }'
```

**预期结果：**

- ✅ HTTP 200
- ✅ success = true
- ✅ 返回评价信息：
  - evaluationId：评价ID
  - submittedTime：提交时间

**响应示例：**
```json
{
  "code": 200,
  "message": "评价提交成功",
  "data": {
    "success": true,
    "evaluationId": 1,
    "submittedTime": "2024-11-01T14:30:00",
    "message": "评价提交成功"
  }
}
```

**验证步骤：**
```sql
-- 验证评价记录
SELECT id, activity_id, teaching_point_id, q1_satisfaction, q2_practicality, q3_quality, suggestion_text 
FROM evaluations 
WHERE activity_id = 1 AND teaching_point_id = 1;
```

---

## 测试用例 4.2：防重复评价（幂等性）

**用例ID：** EVALUATION-002  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 幂等性、防重复评价

**前置条件：**
- 活动1、教学点1已经评价过

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<评价二维码token>",
    "teachingPointId": 1,
    "q1Satisfaction": 3,
    "q2Practicality": 3,
    "q3Quality": 3,
    "suggestionText": "修改建议内容"
  }'
```

**预期结果：**

- ✅ HTTP 400 或 409
- ✅ 返回错误消息："该活动的教学点已评价过，不可重复评价"
- ✅ 数据库中仍只有一条评价记录

---

## 测试用例 4.3：活动未结束无法评价

**用例ID：** EVALUATION-003  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 活动状态检查

**前置条件：**
- 活动ID为2，状态为 ONGOING（活动进行中）

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<活动2的评价二维码token>",
    "teachingPointId": 1,
    "q1Satisfaction": 3,
    "q2Practicality": 2,
    "q3Quality": 3,
    "suggestionText": "建议"
  }'
```

**预期结果：**

- ✅ HTTP 400
- ✅ 返回错误消息："活动未结束，不允许评价"

---

## 测试用例 4.4：未参与活动无法评价

**用例ID：** EVALUATION-004  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 参与资格检查

**前置条件：**
- 活动已结束
- 教学点ID为100（该教学点未打过卡）

**测试步骤：**

```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<评价二维码token>",
    "teachingPointId": 100,
    "q1Satisfaction": 3,
    "q2Practicality": 2,
    "q3Quality": 3,
    "suggestionText": "建议"
  }'
```

**预期结果：**

- ✅ HTTP 400
- ✅ 返回错误消息："无打卡记录，无法评价"

---

## 测试用例 4.5：提交评价参数校验

**用例ID：** EVALUATION-005  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 参数验证

### 场景1：满意度评分超出范围
```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<token>",
    "teachingPointId": 1,
    "q1Satisfaction": 5,
    "q2Practicality": 2,
    "q3Quality": 3,
    "suggestionText": "建议"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："满意度评分必须在1-3之间"

### 场景2：建议文本超长
```bash
curl -X POST "http://localhost:8080/api/evaluations/evaluation" \
  -H "Content-Type: application/json" \
  -d '{
    "token": "<token>",
    "teachingPointId": 1,
    "q1Satisfaction": 3,
    "q2Practicality": 2,
    "q3Quality": 3,
    "suggestionText": "这是一个很长很长的建议文本，超过了200字的限制。这是一个很长很长的建议文本，超过了200字的限制。这是一个很长很长的建议文本，超过了200字的限制。这是一个很长很长的建议文本，超过了200字的限制。"
  }'
```

**预期结果：**
- ✅ HTTP 400
- ✅ 错误消息："建议文本不能超过200字"

---

## 测试用例 4.6：查询评价列表（市级管理员）

**用例ID：** EVALUATION-006  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 查询评价、权限隔离

**前置条件：**
- 市级管理员已登录
- 数据库中有多条评价记录

**测试步骤：**

```bash
# 查询所有评价
curl -X GET "http://localhost:8080/api/evaluations?current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按活动过滤
curl -X GET "http://localhost:8080/api/evaluations?activityId=1&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"

# 按教学点过滤
curl -X GET "http://localhost:8080/api/evaluations?teachingPointId=1&current=1&size=10" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回分页数据
- ✅ 市级管理员可见全部评价记录（所有县）

**响应示例：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "records": [
      {
        "id": 1,
        "activityId": 1,
        "activityName": "2024年秋季教学活动",
        "teachingPointId": 1,
        "teachingPointName": "朝阳区第一小学",
        "q1Satisfaction": 3,
        "q2Practicality": 2,
        "q3Quality": 3,
        "suggestionText": "希望能增加更多互动环节",
        "submittedTime": "2024-11-01T14:30:00"
      }
    ],
    "total": 15,
    "current": 1,
    "size": 10
  }
}
```

---

## 测试用例 4.7：查询评价列表（县级管理员权限隔离）

**用例ID：** EVALUATION-007  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 权限隔离、数据隔离

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/evaluations?current=1&size=10" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 仅返回朝阳区的评价记录
- ✅ 不返回其他县区的数据

---

## 测试用例 4.8：查询评价统计（市级管理员）

**用例ID：** EVALUATION-008  
**优先级：** ⭐⭐⭐⭐⭐ (必须)  
**关键词：** 评价统计、满意度分析

**前置条件：**
- 市级管理员已登录
- 活动ID为1有多条评价记录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/evaluations/statistics?activityId=1" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 返回统计信息：
  - totalCount：总评价数
  - avgSatisfaction：满意度平均分
  - avgPracticality：实用性平均分
  - avgQuality：质量平均分
  - satisfactionLevel3/2/1Count：各等级数量
  - suggestionCount：包含建议的评价数

**响应示例：**
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "activityId": 1,
    "totalCount": 15,
    "avgSatisfaction": 2.8,
    "avgPracticality": 2.6,
    "avgQuality": 2.7,
    "satisfactionLevel3": 12,
    "satisfactionLevel2": 2,
    "satisfactionLevel1": 1,
    "suggestionCount": 10
  }
}
```

---

## 测试用例 4.9：查询评价统计（县级管理员）

**用例ID：** EVALUATION-009  
**优先级：** ⭐⭐⭐⭐ (高)  
**关键词：** 权限隔离、统计

**前置条件：**
- 县级管理员（朝阳区）已登录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/evaluations/statistics?activityId=1" \
  -H "Authorization: Bearer ${COUNTY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ 仅统计朝阳区的评价数据
- ✅ totalCount = 5

---

## 测试用例 4.10：无参与记录的活动评价统计

**用例ID：** EVALUATION-010  
**优先级：** ⭐⭐⭐ (中)  
**关键词：** 空数据处理

**前置条件：**
- 活动ID为3，无评价记录

**测试步骤：**

```bash
curl -X GET "http://localhost:8080/api/evaluations/statistics?activityId=3" \
  -H "Authorization: Bearer ${CITY_ADMIN_TOKEN}" \
  -H "Content-Type: application/json"
```

**预期结果：**

- ✅ HTTP 200
- ✅ totalCount = 0
- ✅ 平均分都为 0
- ✅ 各等级数量都为 0

---

---

# 🧪 集成测试场景

## 场景1：完整的活动生命周期

**场景ID：** INTEGRATION-001  
**覆盖模块：** 活动管理、二维码管理、打卡、评价

**流程：**

1. 创建活动
   ```bash
   POST /api/activities
   ```

2. 验证打卡二维码自动生成
   ```bash
   GET /api/activities/1
   ```

3. 参与者通过打卡二维码提交打卡
   ```bash
   POST /api/checkins/checkin
   ```

4. 查询打卡统计
   ```bash
   GET /api/checkins/statistics/1
   ```

5. 结束活动
   ```bash
   POST /api/activities/1/finish
   ```

6. 参与者提交评价
   ```bash
   POST /api/evaluations/evaluation
   ```

7. 查询评价统计
   ```bash
   GET /api/evaluations/statistics?activityId=1
   ```

**预期结果：**

- ✅ 所有API调用成功
- ✅ 数据流转正确
- ✅ 统计数据准确

---

## 场景2：权限隔离验证

**场景ID：** INTEGRATION-002  
**覆盖模块：** 所有模块

**流程：**

1. 市级管理员创建市级活动
   ```bash
   POST /api/activities (市级)
   ```

2. 县级管理员创建县级活动
   ```bash
   POST /api/activities (县级)
   ```

3. 验证查询权限
   ```bash
   GET /api/activities (市级 - 看到全部)
   GET /api/activities (县级 - 仅看本县)
   ```

4. 验证打卡权限
   ```bash
   GET /api/checkins (市级 - 全部数据)
   GET /api/checkins (县级 - 仅本县)
   ```

5. 验证评价权限
   ```bash
   GET /api/evaluations (市级 - 全部数据)
   GET /api/evaluations (县级 - 仅本县)
   ```

**预期结果：**

- ✅ 市级管理员能看到全部数据
- ✅ 县级管理员只能看到本县数据
- ✅ 权限隔离有效

---

# ✅ 测试检查清单

在执行所有测试后，请检查以下项目：

## 活动管理模块
- [ ] 创建活动成功
- [ ] 二维码自动生成
- [ ] 查询活动列表分页正确
- [ ] 权限隔离有效
- [ ] 活动详情统计数据准确
- [ ] 结束活动后状态正确更新
- [ ] 打卡二维码被禁用，评价二维码保留
- [ ] 县域统计数据准确
- [ ] 参数校验有效
- [ ] 错误处理完善

## 二维码管理模块
- [ ] 生成打卡二维码
- [ ] 生成评价二维码
- [ ] 查询二维码列表
- [ ] 二维码过滤功能正确
- [ ] 禁用二维码
- [ ] 验证有效二维码
- [ ] 验证已禁用二维码
- [ ] 验证过期二维码
- [ ] 验证无效token
- [ ] 参数校验有效

## 打卡参与模块
- [ ] 提交有效打卡
- [ ] 防重复打卡
- [ ] 参数校验有效
- [ ] 无效二维码提交失败
- [ ] 活动已结束打卡失败
- [ ] 查询打卡记录分页正确
- [ ] 市级管理员看到全部数据
- [ ] 县级管理员权限隔离
- [ ] 打卡统计数据准确
- [ ] 未认证无法访问管理接口

## 活动评价模块
- [ ] 提交有效评价
- [ ] 防重复评价
- [ ] 活动未结束无法评价
- [ ] 未参与活动无法评价
- [ ] 参数校验有效
- [ ] 查询评价列表分页正确
- [ ] 市级管理员看到全部数据
- [ ] 县级管理员权限隔离
- [ ] 评价统计数据准确
- [ ] 空数据处理正确

## 集成测试
- [ ] 完整活动生命周期成功
- [ ] 权限隔离有效
- [ ] 数据流转正确
- [ ] 统计数据准确

---

# 📊 性能测试

## 压力测试配置

使用Apache Bench进行压力测试：

```bash
# 发送100个并发请求（打卡接口）
ab -c 100 -n 100 \
  -p checkin.json \
  -T application/json \
  "http://localhost:8080/api/checkins/checkin"

# 发送100个并发请求（查询接口）
ab -c 100 -n 100 \
  -H "Authorization: Bearer ${TOKEN}" \
  "http://localhost:8080/api/activities"
```

## 性能指标预期

| 接口 | 平均响应时间 | 95分位 | 99分位 | 成功率 |
|------|-----------|--------|--------|--------|
| 提交打卡 | < 100ms | < 200ms | < 500ms | 100% |
| 提交评价 | < 100ms | < 200ms | < 500ms | 100% |
| 查询活动 | < 50ms | < 100ms | < 300ms | 100% |
| 查询统计 | < 100ms | < 300ms | < 500ms | 100% |

---

**文档版本：** v1.1.0  
**最后更新：** 2024-11-01  
**状态：** ✅ 已完成
